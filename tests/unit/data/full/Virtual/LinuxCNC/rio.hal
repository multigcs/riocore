
# load the realtime components
loadrt [KINS]KINEMATICS
loadrt [EMCMOT]EMCMOT base_period_nsec=[EMCMOT]BASE_PERIOD servo_period_nsec=[EMCMOT]SERVO_PERIOD num_joints=[KINS]JOINTS num_dio=[EMCMOT]NUM_DIO num_aio=[EMCMOT]NUM_AIO

# pid controller
loadrt pid num_chan=3

# manual toolchanger
loadusr -W hal_manualtoolchange

# fpga board Tangbob
loadrt riocomp-board0

# if you need to test rio without hardware, set it to 1
setp board0.sys-simulation 1

# read
addf board0.readwrite servo-thread
# process
addf pid.0.do-pid-calcs servo-thread
addf pid.1.do-pid-calcs servo-thread
addf pid.2.do-pid-calcs servo-thread
addf motion-command-handler servo-thread
addf motion-controller servo-thread
# write

#################################################################################
# logic and calc components
#################################################################################
loadrt logic names=func.and_13.1,func.or_14.1 personality=0x102,0x202
addf func.and_13.1 servo-thread
addf func.or_14.1 servo-thread

loadrt limit1 names=func.limit1-1
addf func.limit1-1 servo-thread

loadrt deadzone names=func.deadzone-1
addf func.deadzone-1 servo-thread

loadrt abs names=func.abs-1
addf func.abs-1 servo-thread

loadrt sum2 names=func.sum2_3.1,func.sub_4.1
addf func.sum2_3.1 servo-thread
addf func.sub_4.1 servo-thread

loadrt mult2 names=func.mult2_5.1
addf func.mult2_5.1 servo-thread

loadrt div2 names=func.div2_6.1
addf func.div2_6.1 servo-thread

loadrt minmax names=func.minmax-1,func.minmax-2
addf func.minmax-1 servo-thread
addf func.minmax-2 servo-thread

loadrt wcomp names=func.wcomp_under_9.1,func.wcomp_over_10.1,func.wcomp_out_11.1
addf func.wcomp_under_9.1 servo-thread
addf func.wcomp_over_10.1 servo-thread
addf func.wcomp_out_11.1 servo-thread

loadrt not names=func.not_riov_Bool1_value
addf func.not_riov_Bool1_value servo-thread

loadrt toggle names=func.toggle-1
addf func.toggle-1 servo-thread

loadrt timedelay names=func.timedelay-1
addf func.timedelay-1 servo-thread

loadrt oneshot names=func.oneshot-1
addf func.oneshot-1 servo-thread

loadrt mux2 names=func.mux2-1
addf func.mux2-1 servo-thread

#################################################################################
# iocontrol
#################################################################################
net sig_board0_sys-status                => iocontrol.0.emc-enable-in
net tool-change                          <= iocontrol.0.tool-change
net tool-changed                         => iocontrol.0.tool-changed
net tool-prep-number                     <= iocontrol.0.tool-prep-number
net tool-prepared                        <= iocontrol.0.tool-prepare
net tool-prepared                        => iocontrol.0.tool-prepared
net user-enable-out                      <= iocontrol.0.user-enable-out
net user-request-enable                  <= iocontrol.0.user-request-enable

#################################################################################
# board0
#################################################################################
net sig_halui_machine_is-on              => board0.machine-on
net user-enable-out                      => board0.sys-enable
net user-request-enable                  => board0.sys-enable-request
net sig_board0_sys-status                <= board0.sys-status

net sig_pyvcp_board0_wled_0_blue         => board0.wled.0_blue
net sig_pyvcp_board0_wled_0_green        => board0.wled.0_green
net sig_pyvcp_board0_wled_0_red          => board0.wled.0_red

#################################################################################
# halui
#################################################################################
net sig_halui_machine_is-on              <= halui.machine.is-on

net sig_pyvcp_halui_mdi-command-00       => halui.mdi-command-00
net sig_pyvcp_halui_mdi-command-01       => halui.mdi-command-01
net sig_pyvcp_halui_mdi-command-02       => halui.mdi-command-02

#################################################################################
# func
#################################################################################
net sig_riov_Float1_value                => func.abs-1.in
net func_abs-1_out                       <= func.abs-1.out

net func_and_13_1_and                    <= func.and_13.1.and
net sig_riov_Bool1_value                 => func.and_13.1.in-00
net sig_riov_Bool2_value                 => func.and_13.1.in-01

net sig_riov_Float1_value                => func.deadzone-1.in
net func_deadzone-1_out                  <= func.deadzone-1.out

net sig_riov_Float1_value                => func.div2_6.1.in0
net func_div2_6_1_out                    <= func.div2_6.1.out

net sig_riov_Float1_value                => func.limit1-1.in
net func_limit1-1_out                    <= func.limit1-1.out

net sig_riov_Float1_value                => func.minmax-1.in
net func_minmax-1_min                    <= func.minmax-1.min
net sig_riov_Reset_value                 => func.minmax-1.reset
net sig_riov_Float1_value                => func.minmax-2.in
net func_minmax-2_max                    <= func.minmax-2.max
net sig_riov_Reset_value                 => func.minmax-2.reset

net sig_riov_Float1_value                => func.mult2_5.1.in0
net sig_riov_Float2_value                => func.mult2_5.1.in1
net func_mult2_5_1_out                   <= func.mult2_5.1.out

net func_mux2-1_out                      <= func.mux2-1.out
net sig_riov_Bool1_value                 => func.mux2-1.sel

net sig_riov_Bool1_value                 => func.not_riov_Bool1_value.in
net func_not_riov_Bool1_value_out        <= func.not_riov_Bool1_value.out

net sig_riov_Bool1_value                 => func.oneshot-1.in
net func_oneshot-1_out                   <= func.oneshot-1.out

net sig_riov_Bool1_value                 => func.or_14.1.in-00
net sig_riov_Bool2_value                 => func.or_14.1.in-01
net func_or_14_1_or                      <= func.or_14.1.or

net sig_riov_Float1_value                => func.sub_4.1.in0
net sig_riov_Float2_value                => func.sub_4.1.in1
net func_sub_4_1_out                     <= func.sub_4.1.out

net sig_riov_Float1_value                => func.sum2_3.1.in0
net sig_riov_Float2_value                => func.sum2_3.1.in1
net func_sum2_3_1_out                    <= func.sum2_3.1.out

net sig_riov_Bool1_value                 => func.timedelay-1.in
net func_timedelay-1_out                 <= func.timedelay-1.out

net sig_riov_Bool1_value                 => func.toggle-1.in
net func_toggle-1_out                    <= func.toggle-1.out

net sig_riov_Float1_value                => func.wcomp_out_11.1.in
net func_wcomp_out_11_1_out              <= func.wcomp_out_11.1.out

net sig_riov_Float1_value                => func.wcomp_over_10.1.in
net sig_riov_Float2_value                => func.wcomp_over_10.1.max
net sig_riov_Float2_value                => func.wcomp_over_10.1.min
net func_wcomp_over_10_1_over            <= func.wcomp_over_10.1.over

net sig_riov_Float1_value                => func.wcomp_under_9.1.in
net sig_riov_Float2_value                => func.wcomp_under_9.1.max
net sig_riov_Float2_value                => func.wcomp_under_9.1.min
net func_wcomp_under_9_1_under           <= func.wcomp_under_9.1.under

#################################################################################
# joint-0
#################################################################################
setp board0.stepdir0.velocity-scale      [JOINT_0]SCALE_OUT
setp board0.stepdir0.position-scale      [JOINT_0]SCALE_IN
setp pid.0.Pgain                         [JOINT_0]P
setp pid.0.Igain                         [JOINT_0]I
setp pid.0.Dgain                         [JOINT_0]D
setp pid.0.bias                          [JOINT_0]BIAS
setp pid.0.FF0                           [JOINT_0]FF0
setp pid.0.FF1                           [JOINT_0]FF1
setp pid.0.FF2                           [JOINT_0]FF2
setp pid.0.deadband                      [JOINT_0]DEADBAND
setp pid.0.maxoutput                     [JOINT_0]MAXOUTPUT
net j0vel-cmd                            <= pid.0.output
net j0pos-cmd                            <= joint.0.motor-pos-cmd
net j0motor-pos-fb                       <= board0.stepdir0.position
net j0enable                             <= joint.0.amp-enable-out
net j0vel-cmd                            => board0.stepdir0.velocity
net j0pos-cmd                            => pid.0.command
net j0motor-pos-fb                       => joint.0.motor-pos-fb
net j0motor-pos-fb                       => pid.0.feedback
net j0enable                             => pid.0.enable
net j0enable                             => board0.stepdir0.enable

#################################################################################
# joint-1
#################################################################################
setp board0.stepdir1.velocity-scale      [JOINT_1]SCALE_OUT
setp board0.stepdir1.position-scale      [JOINT_1]SCALE_IN
setp pid.1.Pgain                         [JOINT_1]P
setp pid.1.Igain                         [JOINT_1]I
setp pid.1.Dgain                         [JOINT_1]D
setp pid.1.bias                          [JOINT_1]BIAS
setp pid.1.FF0                           [JOINT_1]FF0
setp pid.1.FF1                           [JOINT_1]FF1
setp pid.1.FF2                           [JOINT_1]FF2
setp pid.1.deadband                      [JOINT_1]DEADBAND
setp pid.1.maxoutput                     [JOINT_1]MAXOUTPUT
net j1vel-cmd                            <= pid.1.output
net j1pos-cmd                            <= joint.1.motor-pos-cmd
net j1motor-pos-fb                       <= board0.stepdir1.position
net j1enable                             <= joint.1.amp-enable-out
net j1vel-cmd                            => board0.stepdir1.velocity
net j1pos-cmd                            => pid.1.command
net j1motor-pos-fb                       => joint.1.motor-pos-fb
net j1motor-pos-fb                       => pid.1.feedback
net j1enable                             => pid.1.enable
net j1enable                             => board0.stepdir1.enable

#################################################################################
# joint-2
#################################################################################
setp board0.stepdir2.velocity-scale      [JOINT_2]SCALE_OUT
setp board0.stepdir2.position-scale      [JOINT_2]SCALE_IN
setp pid.2.Pgain                         [JOINT_2]P
setp pid.2.Igain                         [JOINT_2]I
setp pid.2.Dgain                         [JOINT_2]D
setp pid.2.bias                          [JOINT_2]BIAS
setp pid.2.FF0                           [JOINT_2]FF0
setp pid.2.FF1                           [JOINT_2]FF1
setp pid.2.FF2                           [JOINT_2]FF2
setp pid.2.deadband                      [JOINT_2]DEADBAND
setp pid.2.maxoutput                     [JOINT_2]MAXOUTPUT
net j2vel-cmd                            <= pid.2.output
net j2pos-cmd                            <= joint.2.motor-pos-cmd
net j2motor-pos-fb                       <= board0.stepdir2.position
net j2enable                             <= joint.2.amp-enable-out
net j2vel-cmd                            => board0.stepdir2.velocity
net j2pos-cmd                            => pid.2.command
net j2motor-pos-fb                       => joint.2.motor-pos-fb
net j2motor-pos-fb                       => pid.2.feedback
net j2enable                             => pid.2.enable
net j2enable                             => board0.stepdir2.enable

#################################################################################
# setp
#################################################################################
setp func.deadzone-1.center                 0
setp func.deadzone-1.threshold              50
setp func.div2_6.1.in1                      5
setp func.limit1-1.max                      50
setp func.limit1-1.min                      -50
setp func.mux2-1.in0                        -50
setp func.mux2-1.in1                        50
setp func.oneshot-1.falling                 1
setp func.oneshot-1.rising                  1
setp func.oneshot-1.width                   0.3
setp func.sub_4.1.gain1                     -1.0
setp func.timedelay-1.off-delay             1
setp func.timedelay-1.on-delay              1
setp func.wcomp_out_11.1.max                20
setp func.wcomp_out_11.1.min                -20

#################################################################################
# preformated
#################################################################################
